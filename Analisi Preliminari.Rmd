---
title: "Prime analisi"
author: "Mariateresa Russo"
date: "2025-05-31"
output: html_document
---

```{r}
library(readr)
library(dplyr)
library(stringr)
library(tm)
library(plotly)
library(ggplot2)
library(igraph)
library(ggraph)
library(tidytext)
library(RColorBrewer)
library(networkD3)

df_new_comments = read.csv("nutrition_comments_cleaned.csv")
df_new_threads = read.csv("nutrition_threads_cleaned.csv")
```

Autori che postano di più e autori che commentano di più
```{r}
# Conteggio thread per autore
threads_by_author <- df_new_threads %>%
  group_by(author) %>%
  summarise(n_threads = n()) %>%
  arrange(desc(n_threads))

threads_by_author

# Conteggio commenti per autore
comments_by_author <- df_new_comments %>%
  group_by(author) %>%
  summarise(n_comments = n()) %>%
  arrange(desc(n_comments))

comments_by_author
```

```{r}
# Prendi i primi 20 autori con più thread
df_top_authors_threads <- threads_by_author %>%
  slice_max(n_threads, n = 20)

# Crea il grafico a barre orizzontali
plot_ly(
  df_top_authors_threads,
  x = ~n_threads,
  y = ~reorder(author, n_threads),
  type = "bar",
  orientation = "h",
  marker = list(color = "orange")
) %>%
  layout(
    title = "Top 20 autori per numero di thread",
    xaxis = list(title = "Numero di thread"),
    yaxis = list(title = "Autori"),
    margin = list(l = 200)
  )

```
```{r}
# Prendi i primi 20 autori con più commenti
df_top_authors_comments <- comments_by_author %>%
  filter(author != "[deleted]") %>%
  slice_max(n_comments, n = 20)

# Crea il grafico a barre orizzontali
plot_ly(
  df_top_authors_comments,
  x = ~n_comments,
  y = ~reorder(author, n_comments),
  type = "bar",
  orientation = "h",
  marker = list(color = "yellow")
) %>%
  layout(
    title = "Top 20 autori per numero di commenti",
    xaxis = list(title = "Numero di commenti"),
    yaxis = list(title = "Autori"),
    margin = list(l = 200)
  )
```


Paarole più frequenti nei titoli
```{r}
library(tidyverse)
library(tidytext)
library(textstem)  
library(stopwords)  

# Lista di verbi ausiliari personalizzata
custom_stopwords <- c("can", "like", "will", "would", "should", "could")

# Tokenizzazione, rimozione stopwords e stemming (lemmatization)
title_words <- df_new_threads %>%
  unnest_tokens(word, title) %>%
  filter(!word %in% stop_words$word) %>%       # rimozione stopwords standard
  filter(!word %in% custom_stopwords) %>%      # rimozione ausiliari personalizzati
  mutate(word = lemmatize_words(word)) %>%     # stemming/lemmatizzazione
  count(word, sort = TRUE) %>%
  filter(n > 5)

p4 <- ggplot(title_words[1:40,], aes(x = reorder(word, n), y = n)) +
  geom_col(fill = "darkorange") +
  coord_flip() +
  labs(title = "Parole più frequenti nei titoli", x = "Parola", y = "Frequenza")
ggplotly(p4)
```



